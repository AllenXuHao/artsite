<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>æˆ‘çš„è‰ºæœ¯ä½œå“ç½‘ç«™</title>
</head>
<body>
    <h1>æ¬¢è¿æ¥åˆ°æˆ‘çš„è‰ºæœ¯ä½œå“ç½‘ç«™</h1>

    <h2>ä½œå“å±•ç¤ºï¼š</h2>

    {% for art in artworks %}
    <div style="margin-bottom: 40px;">
        <img src="{{ url_for('static', filename='images/' + art.filename) }}" width="400px">
        <p>ä½œå“åç§°ï¼š{{ art.title }}</p>

        <!-- ç‚¹èµåŒºåŸŸ -->
        <!-- ç‚¹èµåŒºåŸŸ -->
        <button 
            onclick="toggleLike({{ art.id }})" 
            id="like-btn-{{ art.id }}"
        >
            {% if art.id in liked_ids %}
                ğŸ’” å–æ¶ˆç‚¹èµ ({{ likes[art.id] }})
            {% else %}
                â¤ï¸ ç‚¹èµ ({{ likes[art.id] }})
            {% endif %}
        </button>

        <h4>è¯„è®ºï¼š</h4>
        <ul>
            {% for c in comments[art.id] %}
                <li>
                    {{ c.text }}
                    <!-- åˆ é™¤æŒ‰é’® -->
                    <form method="post" action="{{ url_for('delete_comment', artwork_id=art.id, comment_id=c.id) }}" style="display:inline;">
                        <button type="submit">ğŸ—‘ åˆ é™¤</button>
                    </form>
                </li>
            {% endfor %}
        </ul>

        <!-- è¯„è®ºæäº¤è¡¨å• -->
        <form method="post">
            <input type="hidden" name="artwork_id" value="{{ art.id }}">
            <textarea name="comment" rows="2" cols="40" placeholder="å†™ä¸‹ä½ çš„è¯„è®º..."></textarea><br>
            <button type="submit">æäº¤è¯„è®º</button>
        </form>
    </div>
    <hr>
    {% endfor %}

    <script>
    function toggleLike(artworkId) {
        fetch(`/like/${artworkId}`, {
            method: 'POST'
    })
    .then(response => response.json())
    .then(data => {
        const btn = document.getElementById(`like-btn-${artworkId}`);
        if (data.liked) {
            btn.innerText = `ğŸ’” å–æ¶ˆç‚¹èµ (${data.likes_count})`;
        } else {
            btn.innerText = `â¤ï¸ ç‚¹èµ (${data.likes_count})`;
        }
    })
    .catch(error => {
        console.error('ç‚¹èµå¤±è´¥:', error);
    });
}
</script>

</body>
</html>